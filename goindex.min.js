(function(){var r=window;var k=new Date(),d=k.getMonth()+1;var s=k.getFullYear()+"-"+d+"-"+k.getDate()+" "+k.getHours()+":"+k.getMinutes()+":"+k.getSeconds();var j={jfVersion:"1.0.0",openTime:s,httpUrlBasic:"/plugin/api/setBasic",httpUrl:"/plugin/api/setHtmlError"};var e=window._maq||[];if(e){for(var g in e){switch(e[g][0]){case"_setAccount":j.account=e[g][1];j.source=e[g][2];break;default:break}}}if(document){j.domain=document.domain||"";j.localUrl=document.URL||"";j.title=document.title||"";j.referrer=document.referrer||""}if(navigator){j.lang=navigator.language||"";j.userAgent=navigator.userAgent||"",j.appVersion=navigator.appVersion||"",j.appName=navigator.appName||"",j.platform=navigator.platform||""}if(r&&r.screen){j.sh=r.screen.height||0;j.sw=r.screen.width||0;j.cd=r.screen.colorDepth||0}var f={set:function(i,m){if(this.get(i)!==null){this.remove(i,false)}localStorage.setItem(i,m)},get:function(m){var i=localStorage.getItem(m);return i===undefined?null:i},remove:function(m,i){if(!i){localStorage.removeItem(m)}},clear:function(){localStorage.clear()}};function p(i){var m;if(i.indexOf("SyntaxError")>0){m="SyntaxError"}else{if(i.indexOf("ReferenceError")>0){m="ReferenceError"}else{if(i.indexOf("RangeError")>0){m="RangeError"}else{if(i.indexOf("TypeError")>0){m="TypeError"}else{if(i.indexOf("URLError")>0){m="URLError"}else{if(i.indexOf("EvalError")>0){m="EvalError"}else{m="Initialize failed"}}}}}}return m}r.onerror=function o(v,i,x,A,m,w){if(v!="Script error."&&!i){return true}var u={};if(!!w&&!!w.stack){u.sMsg=w.stack.toString()}else{if(arguments.callee){var t=[];var y=arguments.callee.caller,z=3;while(y&&(--z>0)){t.push(y.toString());if(y===y.caller){break}y=y.caller}t=t.join(",");u.sMsg=w.stack.toString()}}u.sUrl=i;u.sLine=x;u.sColu=A;u.eObj=m;u.type=p(v);c(u);return u};function c(v){if(typeof v=="object"){if(!r.localStorage){alert("浏览器不支持localStorage");return}var m={type:v.type,sMsg:v.sMsg,sUrl:v.sUrl,sLine:v.sLine,sColu:v.sColu,eObj:v.eObj?v.eObj.stack:""};var u=JSON.stringify(m);var i="err_"+(new Date()-0);f.set(i,u)}}function h(){var t=true;var u=r.navigator.userAgent;var m=r.navigator.connection;if(/MicroMessenger/.test(u)){if(/NetType/.test(u)){var w=u.match(/NetType\/(\S)+/)[0].replace("NetType/","");if(w&&w!="WIFI"){t=false}}else{document.addEventListener("WeixinJSBridgeReady",function i(){WeixinJSBridge.invoke("getNetworkType",{},function(x){if(x.err_msg!="network_type:wifi"){t=false}})})}}else{if(m){var v=m.type;if(v!="wifi"&&v!="2"&&v!="unknown"){t=false}}}r.networkWIFI=t;return r.networkWIFI}var b={get:function(i,m){var t=new XMLHttpRequest();t.open("GET",i,true);t.onreadystatechange=function(){if(t.readyState==4&&t.status==200||t.status==304){m.call(this,t.responseText)}};t.send(null)},post:function(i,t,m){var u=new XMLHttpRequest();u.open("post",i,true);u.setRequestHeader("Content-type","application/json");u.onreadystatechange=function(){if(u.readyState==4&&(u.status==200||u.status==304)){if(m){m.call(this,u.responseText)}}};u.send(t)}};function l(t){var u;if(t==="undefied"&&typeof t!=="object"){return}for(var m in t){if(m.charAt(1)==="r"){u={};u[m]=t[m]}}return u}var a=l(localStorage);var n={account:j.account,jfVersion:j.jfVersion,openTime:j.openTime,source:j.source,userAgent:j.userAgent,appName:j.appName,platform:j.platform,appVersion:j.appVersion,domain:j.domain,localUrl:j.localUrl,title:j.title,referrer:j.referrer,lang:j.lang,sh:j.sh,sw:j.sw,cd:j.cd};n=JSON.stringify(n);var q=JSON.stringify(a);b.post(j.httpUrlBasic,n);if(typeof q!=="undefined"){b.post(j.httpUrl,q,function(m){var i=JSON.parse(m);if(i.success){f.clear()}})}})();